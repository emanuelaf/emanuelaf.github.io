<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Emanuela" />

<meta name="date" content="2018-03-23" />

<title>Elections report</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">My Website</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="elections.html">Data analysis</a>
</li>
<li>
  <a href="lln.html">Statistics</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Elections report</h1>
<h4 class="author"><em>Emanuela</em></h4>
<h4 class="date"><em>March 23, 2018</em></h4>

</div>


<p>In one of my lessons I was to give students an overview on how to compile reports with rmarkdown. As Italians, when it gets to elections time, elections is the only thing we here about in the news for months. So I was inspired by the news, and decided to get them to work on the results of our elections.</p>
<p>This year’s data results is not ready for download yet. Hence I decided to work on the previous elections, that is the 2013 elections.</p>
<p>The report is completely parametrized, so it is not hard to make it work on the new year’s elections.</p>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<!-- Forse dati migliori qui http://www.camera.it/leg17/1209,
oppure versione già aggregata qui http://elezionistorico.interno.gov.it/index.php?tpel=C&dtel=24/02/2013&tpa=I&tpe=A&lev0=0&levsut0=0&es0=S&ms=S
-->
<p>I downloaded the data from … (apis?). As it seems that the website does not have good apis, I uploaded the data on my github so that you can access it too without having to trouble too much like I did. The file is a semi-colon separated file so we import it with the <code>read_delim()</code> and then we easily manipulate the dataset:</p>
<pre class="r"><code>elections &lt;- read_delim(&quot;data/camera_2013_liste_italia.csv&quot;, delim = &quot;;&quot;) %&gt;%
  mutate_all(funs(tolower(.))) 

names(elections) &lt;- tolower(names(elections))</code></pre>
<p>So that the datset looks like this:</p>
<pre class="r"><code>head(elections)</code></pre>
<pre><code>## # A tibble: 6 x 7
##   dataelezione numlista circoscrizione provincia comune
##          &lt;chr&gt;    &lt;chr&gt;          &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;
## 1   24/02/2013        1     piemonte 1    torino aglie&#39;
## 2   24/02/2013        2     piemonte 1    torino aglie&#39;
## 3   24/02/2013        3     piemonte 1    torino aglie&#39;
## 4   24/02/2013        4     piemonte 1    torino aglie&#39;
## 5   24/02/2013        5     piemonte 1    torino aglie&#39;
## 6   24/02/2013        6     piemonte 1    torino aglie&#39;
## # ... with 2 more variables: lista &lt;chr&gt;, votilista &lt;chr&gt;</code></pre>
<p>with info on 152621 sections.</p>
</div>
<div id="how-many-votes-for-the-democratic-party" class="section level2">
<h2>How many votes for the Democratic Party?</h2>
<p>Let us now focus on one party. For example we may focus on the Democratic Party that “won” the 2013 elections.</p>
<p>First let us see what was the percentage of votes that it got in each region</p>
<pre class="r"><code>tab1 &lt;- elections %&gt;%
  separate(circoscrizione, c(&quot;regione&quot;, &quot;altro&quot;), &quot; &quot;) %&gt;%
  group_by(regione, lista) %&gt;%
  mutate(votilista = as.numeric(votilista)) %&gt;%
  summarise(votes = sum(votilista)) %&gt;%
  mutate(perc_votes = round(votes/sum(votes)*100, 2)) %&gt;%
  filter(lista == &quot;partito democratico&quot;) %&gt;%
  select(-lista) %&gt;%
  arrange(desc(perc_votes))  %&gt;%
  ungroup()

knitr::kable(tab1, col.names = c(&quot;Region&quot;, &quot;Num. of votes&quot;, &quot;Percentage of votes&quot;))</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Region</th>
<th align="right">Num. of votes</th>
<th align="right">Percentage of votes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">toscana</td>
<td align="right">831546</td>
<td align="right">37.47</td>
</tr>
<tr class="even">
<td align="left">emilia</td>
<td align="right">989660</td>
<td align="right">37.04</td>
</tr>
<tr class="odd">
<td align="left">umbria</td>
<td align="right">168820</td>
<td align="right">32.07</td>
</tr>
<tr class="even">
<td align="left">liguria</td>
<td align="right">258763</td>
<td align="right">27.69</td>
</tr>
<tr class="odd">
<td align="left">marche</td>
<td align="right">256968</td>
<td align="right">27.69</td>
</tr>
<tr class="even">
<td align="left">basilicata</td>
<td align="right">79696</td>
<td align="right">25.70</td>
</tr>
<tr class="odd">
<td align="left">lazio</td>
<td align="right">850784</td>
<td align="right">25.70</td>
</tr>
<tr class="even">
<td align="left">lombardia</td>
<td align="right">1467161</td>
<td align="right">25.60</td>
</tr>
<tr class="odd">
<td align="left">sardegna</td>
<td align="right">232895</td>
<td align="right">25.16</td>
</tr>
<tr class="even">
<td align="left">piemonte</td>
<td align="right">643835</td>
<td align="right">25.10</td>
</tr>
<tr class="odd">
<td align="left">friuli-venezia</td>
<td align="right">178149</td>
<td align="right">24.72</td>
</tr>
<tr class="even">
<td align="left">molise</td>
<td align="right">42599</td>
<td align="right">22.65</td>
</tr>
<tr class="odd">
<td align="left">abruzzo</td>
<td align="right">175968</td>
<td align="right">22.61</td>
</tr>
<tr class="even">
<td align="left">calabria</td>
<td align="right">209897</td>
<td align="right">22.37</td>
</tr>
<tr class="odd">
<td align="left">campania</td>
<td align="right">652883</td>
<td align="right">21.87</td>
</tr>
<tr class="even">
<td align="left">veneto</td>
<td align="right">628384</td>
<td align="right">21.34</td>
</tr>
<tr class="odd">
<td align="left">sicilia</td>
<td align="right">467410</td>
<td align="right">18.61</td>
</tr>
<tr class="even">
<td align="left">puglia</td>
<td align="right">407900</td>
<td align="right">18.49</td>
</tr>
<tr class="odd">
<td align="left">trentino-alto</td>
<td align="right">101224</td>
<td align="right">16.70</td>
</tr>
</tbody>
</table>
<p>It seems that the democratic party is strong in central Italy, a bit less strong in the north of Italy, and definately not that appealing for the South of Italy. For those that do not know the geography of Italy that well, let us join the information on the macro area near each region:</p>
<pre class="r"><code>macro_area &lt;- read_csv(&quot;data/macro-area&quot;)
  
tab1 &lt;- left_join(tab1, macro_area, by = c(&quot;regione&quot;))

knitr::kable(tab1, col.names = c(&quot;Region&quot;, &quot;Num. of votes&quot;, &quot;Percentage of votes&quot;, &quot;Macroarea&quot;))</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Region</th>
<th align="right">Num. of votes</th>
<th align="right">Percentage of votes</th>
<th align="left">Macroarea</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">toscana</td>
<td align="right">831546</td>
<td align="right">37.47</td>
<td align="left">centro</td>
</tr>
<tr class="even">
<td align="left">emilia</td>
<td align="right">989660</td>
<td align="right">37.04</td>
<td align="left">centro</td>
</tr>
<tr class="odd">
<td align="left">umbria</td>
<td align="right">168820</td>
<td align="right">32.07</td>
<td align="left">centro</td>
</tr>
<tr class="even">
<td align="left">liguria</td>
<td align="right">258763</td>
<td align="right">27.69</td>
<td align="left">nord</td>
</tr>
<tr class="odd">
<td align="left">marche</td>
<td align="right">256968</td>
<td align="right">27.69</td>
<td align="left">centro</td>
</tr>
<tr class="even">
<td align="left">basilicata</td>
<td align="right">79696</td>
<td align="right">25.70</td>
<td align="left">sud e isole</td>
</tr>
<tr class="odd">
<td align="left">lazio</td>
<td align="right">850784</td>
<td align="right">25.70</td>
<td align="left">centro</td>
</tr>
<tr class="even">
<td align="left">lombardia</td>
<td align="right">1467161</td>
<td align="right">25.60</td>
<td align="left">nord</td>
</tr>
<tr class="odd">
<td align="left">sardegna</td>
<td align="right">232895</td>
<td align="right">25.16</td>
<td align="left">sud e isole</td>
</tr>
<tr class="even">
<td align="left">piemonte</td>
<td align="right">643835</td>
<td align="right">25.10</td>
<td align="left">nord</td>
</tr>
<tr class="odd">
<td align="left">friuli-venezia</td>
<td align="right">178149</td>
<td align="right">24.72</td>
<td align="left">nord</td>
</tr>
<tr class="even">
<td align="left">molise</td>
<td align="right">42599</td>
<td align="right">22.65</td>
<td align="left">sud e isole</td>
</tr>
<tr class="odd">
<td align="left">abruzzo</td>
<td align="right">175968</td>
<td align="right">22.61</td>
<td align="left">centro</td>
</tr>
<tr class="even">
<td align="left">calabria</td>
<td align="right">209897</td>
<td align="right">22.37</td>
<td align="left">sud e isole</td>
</tr>
<tr class="odd">
<td align="left">campania</td>
<td align="right">652883</td>
<td align="right">21.87</td>
<td align="left">sud e isole</td>
</tr>
<tr class="even">
<td align="left">veneto</td>
<td align="right">628384</td>
<td align="right">21.34</td>
<td align="left">nord</td>
</tr>
<tr class="odd">
<td align="left">sicilia</td>
<td align="right">467410</td>
<td align="right">18.61</td>
<td align="left">sud e isole</td>
</tr>
<tr class="even">
<td align="left">puglia</td>
<td align="right">407900</td>
<td align="right">18.49</td>
<td align="left">sud e isole</td>
</tr>
<tr class="odd">
<td align="left">trentino-alto</td>
<td align="right">101224</td>
<td align="right">16.70</td>
<td align="left">nord</td>
</tr>
</tbody>
</table>
<div id="those-that-did-not-vote-for-the-democratic-party-did-they-vote-for-another-left-wing-party" class="section level3">
<h3>Those that did not vote for the democratic party, did they vote for another left wing party?</h3>
<p>In other words, I would like to find out whether there are regions in which both the percentage of votes to the democratic party and the percentage of votes to another left wing party are high. By doing so I should identify left-wing regions where both percentages are high and righ wing regions in which both percentage are low. Or regions in which one of the two party has attracted most votes leavig the other one with none.</p>
<p>At the time, the second biggest left wing party was called “ecologia sinistra liberta’”.</p>
<pre class="r"><code>tab2 &lt;- elections %&gt;%
  separate(circoscrizione, c(&quot;regione&quot;, &quot;altro&quot;), &quot; &quot;) %&gt;%
  group_by(regione, lista) %&gt;%
  mutate(votilista = as.numeric(votilista)) %&gt;%
  summarise(votes = sum(votilista)) %&gt;%
  mutate(perc_votes_sel = round(votes/sum(votes)*100, 2)) %&gt;%
  filter(lista == &quot;sinistra ecologia liberta&#39;&quot;) %&gt;%
  select(-lista) %&gt;%
  ungroup()

tab2 &lt;- left_join(tab1, tab2, by = &quot;regione&quot;) 

ggplot(data = tab2, aes(x = perc_votes, y = perc_votes_sel)) +
  geom_point(aes(col = macroarea), size = 1) +
  labs(y = &quot;Other left wing party&quot;, x = &quot;Democratic Party&quot;) +
  geom_label_repel(aes(label = regione, col = macroarea), size = 3) +
  theme_bw()</code></pre>
<p><img src="elections_files/figure-html/analisi%20partito2-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The plot returns what we expected. Central Italian regions such as Tuscany and Emilia-Romagna are well known for being left wing regions and in fact both the Democratic Party and the second largest left wing party got quite a good percentage of votes, while other regions, such as Veneto and Sicily, both left parties did not go well. Puglia at the time had a governor of “sinistra ecologia liberta’”, hence the left party votes in that region went mainly to it, disadvantaging the Democratic Party.</p>
</div>
</div>
<div id="mapping-the-votes" class="section level2">
<h2>Mapping the votes</h2>
<p>Last let us visualise on a map what is happening to the Italian peninsula. Using the development version of the package <code>mapIT</code> available on github, we plot the data. Notice that the <code>mapIT</code> function works with regions id, hence we better make sure that the regions are correctly identified.</p>
<p>Problems may arise with special characters, capital letters and with region names with more than one word, such as Emilia Romagna for example. Apostrophes, ticks and capital letters are ignored by the <code>mapIT</code> function, but unfortuntaley we trunctaed some of the region names. So let us manually complete those and then we plot it:</p>
<pre class="r"><code>tab1 &lt;- tab1 %&gt;%
  mutate(regione = ifelse(regione == &quot;emilia&quot;,&quot;emilia romagna&quot;,
                          ifelse(regione == &quot;friuli-venezia&quot;, &quot;friuli-venezia giulia&quot;,
                                 ifelse(regione == &quot;trentino-alto&quot;, &quot;trentino-alto adige&quot;, regione))))</code></pre>
<p>And finally plot the percentage of votes obtained by the Democratic Party on the Italian map:</p>
<pre class="r"><code>mapIT(perc_votes, regione, data = data.frame(tab1),
      graphPar = list(low = &quot;#F5A9A9&quot;, high = &quot;#DF0101&quot;,
      show_guide = &quot;Percentage of votes&quot;))</code></pre>
<p><img src="elections_files/figure-html/unnamed-chunk-4-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
<div id="paramtrize-your-report-with-rmarkdown" class="section level2">
<h2>Paramtrize your report with <code>Rmarkdown</code></h2>
<p>All the above analysis is focused on the situation of the Italian left wing party in the 2013 elections. However one may be interested in a different year or different parties.</p>
<p>You can do that by paramtrising your report with Rmarkdown and here is how you can do that.</p>
<p>At the very beginning of your <code>.Rmd</code> file you find</p>
<pre><code>---
  title: &quot;Title&quot;
author: &quot;Author&quot;
date: &quot;&quot;
output:
  pdf_document: default
html_document: default</code></pre>
<p>Here you may add your parameters:</p>
<pre><code>---
  title: &quot;Title&quot;
author: &quot;Author&quot;
date: &quot;&quot;
output:
  pdf_document: default
html_document: default
params:
  party1: partito democratico
  party2: sinistra ecologia liberta&#39;
  year: 2013
---</code></pre>
<p>We have added 3 parameters: one indicating the year, that in this case may only be 2013 as data on other year’s elections is not included in the file, one indictaing the main party we analyse and the second one indicating the second party with whom we want to compare it.</p>
<p>Then, every tim you want to mention the democratic party, you should write <code>r params$party1</code> and so on.</p>
<p>If you want to analyse a different party you just modify party1 or party2 and then compile your report by clicking on the <code>Knit</code> botton.</p>
<p>If you click on <code>Knit with parameters</code> a user interface, based on Shiny, will open up and you will be able to enter and modify the parameters. At this point it may be nice to provide a list of all the possible values for that parameter: so for instance you may add the main parties:</p>
</div>
<div id="section" class="section level2">
<h2>```</h2>
<p>title: “” author: “” date: “” output: html_document: default pdf_document: default params: year: 2013 party1: choices: - partito democratico - sinistra ecologia liberta’ - popolo delle liberta’ - lega nord - fratelli d’italia - movimento 5 stelle beppegrillo.it input: select label: ‘Main party:’ value: partito democratico party2: choices: - partito democratico - sinistra ecologia liberta’ - popolo delle liberta’ - lega nord - fratelli d’italia - movimento 5 stelle beppegrillo.it input: select label: ‘Comparison party:’ value: sinistra ecologia liberta’ —</p>
<p>```</p>
<p>This code will open up an interface in which you can enter the year, then you can choose the main party from a list of 6 possible values and then a comparison party from a drop down menu with 6 different alternatives.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
